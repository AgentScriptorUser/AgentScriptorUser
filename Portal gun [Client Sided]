
function make_portal_gun() portal_gun = Instance.new("Tool") portal_gun.Name = "Portal_Gun" portal_gun.Parent = workspace

Handle = Instance.new("Part")
Handle.Name = "Handle"
Handle.Parent = portal_gun
Handle.Color = Color3.fromRGB(231, 231, 236)
Handle.Material = Enum.Material.Plastic
Handle.Size = Vector3.new(1.045, 0.453, 0.453)
Handle.Position = Vector3.new(-10.028, 4.312, 19.112)
Handle.Orientation = Vector3.new(0, -180, 107.64)
Handle.BackSurface = Enum.SurfaceType.SmoothNoOutlines
Handle.BottomSurface = Enum.SurfaceType.SmoothNoOutlines
Handle.FrontSurface = Enum.SurfaceType.SmoothNoOutlines
Handle.LeftSurface = Enum.SurfaceType.SmoothNoOutlines
Handle.RightSurface = Enum.SurfaceType.SmoothNoOutlines
Handle.TopSurface = Enum.SurfaceType.SmoothNoOutlines

Union = Instance.new("Part")
Union.Color = Color3.fromRGB(0, 255, 0)
Union.Material = Enum.Material.Plastic
Union.Transparency = 0.45
Union.Name = "Union"
Union.Size = Vector3.new(0.304, 0.476, 0.302)
Union.Position = Vector3.new(-8.972, 5.269, 19.079)
Union.Orientation = Vector3.new(0, 180, -3.64)
Union.Parent = portal_gun

part1 = Instance.new("Part")
part1.Name = "part1"
part1.Color = Color3.fromRGB(17, 17, 17)
part1.Material = Enum.Material.Plastic
part1.Size = Vector3.new(0.2, 0.24, 0.99)
part1.Position = Vector3.new(-8.716, 4.926, 19.111)
part1.Orientation = Vector3.new(0, 180, -3.64)
part1.BackSurface = Enum.SurfaceType.SmoothNoOutlines
part1.BottomSurface = Enum.SurfaceType.SmoothNoOutlines
part1.FrontSurface = Enum.SurfaceType.SmoothNoOutlines
part1.LeftSurface = Enum.SurfaceType.SmoothNoOutlines
part1.RightSurface = Enum.SurfaceType.SmoothNoOutlines
part1.TopSurface = Enum.SurfaceType.SmoothNoOutlines
part1.Parent = portal_gun

part2 = Instance.new("Part")
part2.Name = "part2"
part2.Color = Color3.fromRGB(231, 231, 236)
part2.Material = Enum.Material.Plastic
part2.Size = Vector3.new(1.04, 0.3, 0.48)
part2.Position = Vector3.new(-9.874, 4.855, 19.095)
part2.Orientation = Vector3.new(-0.02, 90, 0)
part2.BackSurface = Enum.SurfaceType.SmoothNoOutlines
part2.BottomSurface = Enum.SurfaceType.SmoothNoOutlines
part2.FrontSurface = Enum.SurfaceType.SmoothNoOutlines
part2.LeftSurface = Enum.SurfaceType.SmoothNoOutlines
part2.RightSurface = Enum.SurfaceType.SmoothNoOutlines
part2.TopSurface = Enum.SurfaceType.SmoothNoOutlines
part2.Shape = Enum.PartType.Cylinder
part2.Parent = portal_gun

part3 = Instance.new("Part")
part3.Name = "part3"
part3.Color = Color3.fromRGB(17, 17, 17)
part3.Material = Enum.Material.Plastic
part3.Size = Vector3.new(0.2, 0.47, 0.45)
part3.Position = Vector3.new(-8.939, 4.948, 19.086)
part3.Orientation = Vector3.new(3.47, -90, -90)
part3.Shape = Enum.PartType.Cylinder
part3.Parent = portal_gun

part4 = Instance.new("Part")
part4.Name = "part4"
part4.Color = Color3.fromRGB(231, 231, 236)
part4.Material = Enum.Material.Plastic
part4.Size = Vector3.new(1.04, 0.3, 0.48)
part4.Position = Vector3.new(-9.874, 4.845, 19.095)
part4.Orientation = Vector3.new(-0.02, 90, 0)
part4.Shape = Enum.PartType.Cylinder
part4.BackSurface = Enum.SurfaceType.SmoothNoOutlines
part4.BottomSurface = Enum.SurfaceType.SmoothNoOutlines
part4.FrontSurface = Enum.SurfaceType.SmoothNoOutlines
part4.LeftSurface = Enum.SurfaceType.SmoothNoOutlines
part4.RightSurface = Enum.SurfaceType.SmoothNoOutlines
part4.TopSurface = Enum.SurfaceType.SmoothNoOutlines
part4.Parent = portal_gun

part5 = Instance.new("Part")
part5.Name = "part5"
part5.Color = Color3.fromRGB(17, 17, 17)
part5.Material = Enum.Material.Plastic
part5.Parent = portal_gun
part5.Size = Vector3.new(0.2, 0.2, 0.2)
part5.Position = Vector3.new(-9.894, 4.93, 19.061)
part5.Orientation = Vector3.new(11.67, -90, -90)

part6 = Instance.new("Part")
part6.Name = "part6"
part6.Color = Color3.fromRGB(0, 255, 0)
part6.Material = Enum.Material.Neon
part6.Size = Vector3.new(0.2, 0.31, 0.2)
part6.Position = Vector3.new(-8.715, 4.919, 19.095)
part6.Orientation = Vector3.new(0, 180, -3.64)
part6.Shape = Enum.PartType.Cylinder
part6.Parent = portal_gun

part7 = Instance.new("Part")
part7.Name = "part7"
part7.Color = Color3.fromRGB(231, 231, 236)
part7.Material = Enum.Material.Plastic
part7.Size = Vector3.new(1.04, 0.3, 0.48)
part7.Position = Vector3.new(-9.874, 4.865, 19.095)
part7.Orientation = Vector3.new(-0.02, 90, 0)
part7.BackSurface = Enum.SurfaceType.SmoothNoOutlines
part7.BottomSurface = Enum.SurfaceType.SmoothNoOutlines
part7.FrontSurface = Enum.SurfaceType.SmoothNoOutlines
part7.LeftSurface = Enum.SurfaceType.SmoothNoOutlines
part7.RightSurface = Enum.SurfaceType.SmoothNoOutlines
part7.TopSurface = Enum.SurfaceType.SmoothNoOutlines
part7.Shape = Enum.PartType.Cylinder
part7.Parent = portal_gun

part10 = Instance.new("Part")
part10.Name = "part10"
part10.Color = Color3.fromRGB(0, 255, 0)
part10.Material = Enum.Material.Neon
part10.Size = Vector3.new(0.2, 0.31, 0.2)
part10.Position = Vector3.new(-8.715, 4.919, 19.456)
part10.Orientation = Vector3.new(0, 180, -3.64)
part10.Shape = Enum.PartType.Cylinder
part10.Parent = portal_gun

part11 = Instance.new("Part")
part11.Name = "part11"
part11.Color = Color3.fromRGB(0, 255, 0)
part11.Size = Vector3.new(0.2, 0.31, 0.2)
part11.Position = Vector3.new(-8.715, 4.919, 18.765)
part11.Orientation = Vector3.new(0, 180, -3.64)
part11.Shape = Enum.PartType.Cylinder
part11.Parent = portal_gun

part12 = Instance.new("Part")
part12.Name = "part12"
part12.Color = Color3.fromRGB(231, 231, 236)
part12.Material = Enum.Material.Plastic
part12.Size = Vector3.new(1.31, 0.27, 1.03)
part12.Position = Vector3.new(-9.279, 4.886, 19.101)
part12.Orientation = Vector3.new(0, 180, -3.64)
part12.BackSurface = Enum.SurfaceType.SmoothNoOutlines
part12.BottomSurface = Enum.SurfaceType.SmoothNoOutlines
part12.FrontSurface = Enum.SurfaceType.SmoothNoOutlines
part12.LeftSurface = Enum.SurfaceType.SmoothNoOutlines
part12.RightSurface = Enum.SurfaceType.SmoothNoOutlines
part12.TopSurface = Enum.SurfaceType.SmoothNoOutlines
part12.Parent = portal_gun

part14 = Instance.new("Part")
part14.Name = "part14"
part14.Color = Color3.fromRGB(231, 231, 236)
part14.Material = Enum.Material.Plastic
part14.Size = Vector3.new(1.04, 0.3, 0.48)
part14.Position = Vector3.new(-9.874, 4.875, 19.095)
part14.Orientation = Vector3.new(-0.02, 90, 0)
part14.Shape = Enum.PartType.Cylinder
part14.BackSurface = Enum.SurfaceType.SmoothNoOutlines
part14.BottomSurface = Enum.SurfaceType.SmoothNoOutlines
part14.FrontSurface = Enum.SurfaceType.SmoothNoOutlines
part14.LeftSurface = Enum.SurfaceType.SmoothNoOutlines
part14.RightSurface = Enum.SurfaceType.SmoothNoOutlines
part14.TopSurface = Enum.SurfaceType.SmoothNoOutlines
part14.Parent = portal_gun

portal_gun.GripForward = Vector3.new(0, 0, -1)
portal_gun.GripPos = Vector3.new(0, -0.2, 0)
portal_gun.GripRight = Vector3.new(0, 0, -1)
portal_gun.GripUp = Vector3.new(1, 0.015, 0)

portal_sound = Instance.new("Sound")
portal_sound.Parent = portal_gun.Handle
portal_sound.SoundId = "rbxassetid://1013378689"
portal_sound.Volume = 2.5

function Weld(x, y)
local W = Instance.new("Weld")
W.Part0 = x
W.Part1 = y
local CJ = CFrame.new(x.Position)
local C0 = x.CFrame:inverse() * CJ
local C1 = y.CFrame:inverse() * CJ
W.C0 = C0
W.C1 = C1
W.Parent = x
end

for i, v in pairs(portal_gun:GetChildren()) do
if v:IsA("Part") then
Weld(v, portal_gun.Handle)
end
end

-- Variables to store the portals
local portals = {}

-- Max portals allowed
local MAX_PORTALS = 2

local function create_portal(position, color)
-- Create an invisible part for holding the decals
local portalPart = Instance.new("Part")
portalPart.Size = Vector3.new(5, 8, 0.2)  -- Size of the portal
portalPart.Position = position
portalPart.Color = Color3.fromRGB(0, 255, 0)  -- Green color
portalPart.Material = Enum.Material.SmoothPlastic
portalPart.Anchored = true
portalPart.CanCollide = false
portalPart.Transparency = 0  -- Set to fully visible
portalPart.Parent = workspace

-- Add the decal on the front face  
local decal1 = Instance.new("Decal")  
decal1.Face = Enum.NormalId.Front  
decal1.Texture = "rbxassetid://7493310007"  -- Texture for front of the portal  
decal1.Parent = portalPart  

-- Add the decal on the back face  
local decal2 = Instance.new("Decal")  
decal2.Face = Enum.NormalId.Back  
decal2.Texture = "rbxassetid://7493310007"  -- Texture for back of the portal  
decal2.Parent = portalPart  

-- Create a touch detection part for teleportation, which is still invisible but functional  
local portal_touch = Instance.new("Part")  
portal_touch.Size = Vector3.new(5, 8, 0.1)  
portal_touch.Position = position  
portal_touch.Anchored = true  
portal_touch.CanCollide = false  
portal_touch.Parent = portalPart  

-- Add the portal to the portals table  
table.insert(portals, portalPart)  

-- If we've reached the max portal count, remove the oldest one  
if #portals > MAX_PORTALS then  
    local old_portal = table.remove(portals, 1)  
    if old_portal and old_portal.Parent then  
        old_portal:Destroy()  
    end  
end  

-- Teleportation logic (no tweening, direct teleport)  
local function onTouched(hit)  
    local character = hit.Parent  
    if character:FindFirstChild("Humanoid") then  
        -- Check if the player has already been teleported  
        if not character:FindFirstChild("Teleported") then  
            -- Create a Teleported flag to prevent future teleportation  
            local teleportedFlag = Instance.new("BoolValue")  
            teleportedFlag.Name = "Teleported"  
            teleportedFlag.Parent = character  

            -- Remove flag after 1 second  
            task.delay(1, function()  
                if teleportedFlag then  
                    teleportedFlag:Destroy()  
                end  
            end)  

            -- Teleport player to the other portal's position directly  
            for _, other_portal in pairs(portals) do  
                if other_portal ~= portalPart then  
                    local other_position = other_portal.Position  
                    -- Directly set the player's position to the other portal's position  
                    character:SetPrimaryPartCFrame(CFrame.new(other_position))  

                    -- Play teleport sound for effect  
                    portal_sound:Play()  

                    -- Disconnect the event to prevent double teleport  
                    portal_touch.Touched:Disconnect()  

                    -- Reconnect the touch event to allow teleporting again after flag removal  
                    portal_touch.Touched:Connect(onTouched)  
                end  
            end  
        end  
    end  
end  

-- Connect the touch event to teleportation logic  
portal_touch.Touched:Connect(onTouched)

end

-- Activate portal gun
portal_gun.Activated:Connect(function()
local mouse = game.Players.LocalPlayer:GetMouse()
local target_pos = mouse.Hit.p
local color = Color3.fromRGB(0, 255, 255)  -- Portal color

-- Create the portal  
create_portal(target_pos, color)  

-- Play the portal sound  
portal_sound:Play()

end)

portal_gun.Parent = game.Players.LocalPlayer.Backpack

end

make_portal_gun()
